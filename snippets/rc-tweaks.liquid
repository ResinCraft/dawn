<script type="text/javascript">
  // Global Stuff
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  
  // Show available stock
  var stock = [];
  {% for variant in product.variants %}
  	stock[{{ variant.id }}] = {{ variant.inventory_quantity }};
  {% endfor %}

  if(urlParams.has('variant')) {
  	onVariantChange()
  }

  this.addEventListener('change', this.onVariantChange);

  function onVariantChange() {
    const newQueryString = window.location.search;
    const newUrlParams = new URLSearchParams(newQueryString);
    const newVariant = newUrlParams.get('variant');

    if(newVariant){
      var msg = msgText(stock[newVariant]);

      var element = document.getElementById('stock-level');
      element.innerHTML = msg;
    }
    //console.log(typeof window.Shopify);
  }

  function msgText(stockLevel) {
    var text = "Sold out!";
    if(stockLevel > 10) {
      text = "More than 10 available";
    } else {
      text = "Only " + stockLevel + " left!";
    }
    return text;
  }

  // Ask user to select an option
  var selectObjects = document.getElementsByClassName('select__select');
  
  Array.prototype.forEach.call(selectObjects, function(selectObject) {
    optionText = selectObject.name;
    optionText = optionText.match(/\[(.*?)\]/)[1];
    
    var x = document.getElementById(selectObject.id);
    var option = document.createElement("option");
    option.text = "Select " + optionText + "...";
    if(!urlParams.has('variant')) {
		option.selected = true;
    }
    x.add(option, x[0]);
  });
  
console.log(typeof window.Shopify);
</script>