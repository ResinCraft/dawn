<script>
  	var productOptions = [];

    {% for product_option in product.options_with_values %}
        productOptions.push("{{ product_option.name | replace: '"', '\\"' }}");
    {% endfor %}
                            
    function setDefaultOption(productOption,select)
    {
		urlParams = new URLSearchParams(window.location.search);
      	optionText = "Select " + productOption + "..."
        var option = document.createElement("option");
        option.text = optionText;
      	option.value = optionText;
        select.add(option, select[0]); //add the option to the selector at the top
      
        //only select this option if there is no pre-selected variant. i.e. the url doesn't have a "?variant=1234" value.
        if(!urlParams.has('variant')) {
			option.selected = true;
          	select.dispatchEvent(new Event("change", { bubbles: true })); //tell global.js that the variant has been selected
        }
    }

  	function noOption(select){
      	let urlParams = new URLSearchParams(window.location.search);
       	urlParams.delete('variant');
        var newUrl = location.href.replace(location.search, '');
        (urlParams.toString() != '') ? newUrl = '?'+urlParams.toString() : newUrl = urlParams.toString();
        var newUrl = location.href.replace(location.search, '')+newUrl;
        window.history.pushState('object', document.title, newUrl);
  	}
  	function updateSelect(select)
    {
      	
      	(select.selectedIndex == 0) ? noOption(select) :;
    }
	
  	//execute this code once the page has rendered (global.js is deferred, got to run after that)
  	window.addEventListener('DOMContentLoaded', function() {
      	productOptions.forEach(function(productOption) {
          	selectName = 'options['+productOption+']';
        	var select = document.getElementsByName(selectName)[0];
          
          	select.addEventListener('change', function() {updateSelect(select)});
          	setDefaultOption(productOption,select);
        });
	});
</script>