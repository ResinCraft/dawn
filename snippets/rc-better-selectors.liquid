<script type="text/javascript">
    var productOptionNames = [];
    var productOptionValues = [];
    {% for product_option in product.options_with_values %}
        productOptionNames.push("{{ product_option.name | replace: '"', '\\"' }}");
    {% endfor %}
    /*
    const variants = [
        {name: 'apples', quantity: 2},
        {name: 'bananas', quantity: 0},
        {name: 'cherries', quantity: 5}
    ];

    function isCherries(fruit) {
    return ;
    }

    console.log(inventory.find(fruit.name === 'cherries'));
    // { name: 'cherries', quantity: 5 }
    inventory.find( ({ option1 }) => option1 === '12mm (1/2 in.)' )
    */
    var variants = [];
    {% for variant in product.variants %}
        variants.push({option1: '{{variant.option1}}', option2: '{{variant.option2}}', option3: '{{variant.option3}}'});
    {% endfor %}

    //console.log('productOptionNames: '+productOptionNames);
    console.log('productOptionValues: '+productOptionValues[0]);
  	var result = variants.find( ({ option1 }) => option1 === '12mm (1/2 in.)' );
    console.log('variants: '+JSON.stringify(variants));
    
    function setDefaultOption(select,optionName)
    {
        optionText = "Select " + optionName + "..."

        //build the option that is going to be inserted into the drop down box
        var option = document.createElement("option");
        option.text = optionText;

        //only trigger this option if there is no pre-selected variant. i.e. the url doesn't have a "?variant=1234" value.
        const urlParams = new URLSearchParams(window.location.search);
        if(!urlParams.has('variant')) {
            option.selected = true;
        }

        //add the option to the selector at the top
        select.add(option, select[0]);
    }

    function validateOptions(select,parent)
    {
        console.log('select: '+select);
        console.log('parent: '+parent);
        Array.prototype.forEach.call(select, function(option) {
            console.log('option: '+option.value);
        });
    }

    function modifySelect(select)
    {
        const selects = document.getElementsByClassName("select__select");
      	const selectContainers = document.getElementsByClassName("product-form__input product-form__input--dropdown");
        selectName = select.name;
        optionText = selectName.match(/\[(.*?)\]/)[1];
        selectorIndex = productOptionNames.indexOf(optionText);
        switch (selectorIndex) {
          case 0:
            break;
          case 1:
            if(selects[selectorIndex - 1].selectedIndex == 0){
                selectContainers[selectorIndex].style.display = 'none';
            } else {
                validateOptions(select,selects[selectorIndex - 1].value)
              	selectContainers[selectorIndex].style.display = '';
            }
            break;
          case 2:
            if(selects[selectorIndex - 1].selectedIndex == 0 || selects[selectorIndex - 2].selectedIndex == 0){
                selectContainers[selectorIndex].style.display = 'none';
            } else {
              	selectContainers[selectorIndex].style.display = '';
            }
        }
    }

    const selects = document.getElementsByClassName("select__select");
    Array.prototype.forEach.call(selects, function(select, i) {
        setDefaultOption(select,productOptionNames[i]);
        modifySelect(select);
    });

    this.addEventListener('change', this.onVariantChange);

    function onVariantChange() {
        Array.prototype.forEach.call(selects, function(select) {
            modifySelect(select);
        });
    }
</script>