{% if request.page_type == 'product' %}
    <script type="text/javascript">
      var Shopify = Shopify || {};
      const selects = document.getElementsByClassName("select__select");
      Shopify.optionsMap = {};

      Shopify.updateOptionsInSelector = function(selectorIndex) {

        switch (selectorIndex) {
          case 0:
            var key = 'root';
            var selector = selects[0];
            break;
          case 1:
            var key = selects[0].value;
            var selector = selects[1];
            break;
          case 2:
            var key = selects[0].value;  
            key += ' / ' + selects[1].value;
            var selector = selects[2];
        }
        var initialValue = undefined;
        //selector.empty();    
        var availableOptions = Shopify.optionsMap[key];
        for (var i=0; i<availableOptions.length; i++) {
          var option = availableOptions[i];
          //var newOption = jQuery('<option></option>').val(option).html(option);
          var newOption = document.createElement("option");
          newOption.value = option;
          selector.add(newOption);
          //selector.append(newOption);
        }
        jQuery('.swatch[data-option-index="' + selectorIndex + '"] .swatch-element').each(function() {
          if (jQuery.inArray($(this).attr('data-value'), availableOptions) !== -1) {
            $(this).removeClass('soldout').show().find(':radio').removeAttr('disabled','disabled').removeAttr('checked');
          }
          else {
            $(this).addClass('soldout').hide().find(':radio').removeAttr('checked').attr('disabled','disabled');
          }
        });
        if (jQuery.inArray(initialValue, availableOptions) !== -1) {
          selector.val(initialValue);
        }
        selector.trigger('change');  
      }
      

    </script>
{% endif %}