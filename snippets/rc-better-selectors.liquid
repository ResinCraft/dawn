{% if request.page_type == 'product' %}
    <script type="text/javascript">
      function removeOptions(selectElement) {
         var i, L = selectElement.options.length - 1;
         for(i = L; i >= 0; i--) {
            selectElement.remove(i);
         }
      }
      
      var Shopify = Shopify || {};
      const selects = document.getElementsByClassName("select__select");
      Shopify.optionsMap = {};

      Shopify.updateOptionsInSelector = function(selectorIndex) {

        switch (selectorIndex) {
          case 0:
            var key = 'root';
            var selector = selects[0];
            break;
          case 1:
            var key = selects[0].value;
            var selector = selects[1];
            break;
          case 2:
            var key = selects[0].value;  
            key += ' / ' + selects[1].value;
            var selector = selects[2];
        }
        var initialValue = undefined;
        removeOptions(selector);
        var availableOptions = Shopify.optionsMap[key];
        console.log('availableOptions: ' + availableOptions);
        for (var i=0; i<availableOptions.length; i++) {
          var option = availableOptions[i];
          //var newOption = jQuery('<option></option>').val(option).html(option);
          var newOption = document.createElement("option");
          newOption.value = option;
          selector.add(newOption);
          //selector.append(newOption);
        }

        if (jQuery.inArray(initialValue, availableOptions) !== -1) {
          selector.val(initialValue);
        }
        selector.trigger('change');  
      }
      
Shopify.updateOptionsInSelector(0);
    </script>
{% endif %}